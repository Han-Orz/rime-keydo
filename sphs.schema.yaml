# 键道·我流@SPHS默认设置
# encoding: utf-8

# 输入方案概要
schema:
  schema_id: sphs # 方案识别名称（用于代码引用）
  name: 键道·我流 # 方案显示名称（用于方案切换）
  version: "1.0" # 版本号
  author: # 方案作者（在Rime中勾选方案时会予以显示）
    - 奠基者 - 大牛（吅吅大山）
    - 求道者 - SPHS
  description: | # 方案描述（在Rime中勾选方案时会予以显示）
    「键道·我流」是一款脱胎于「星空键道」的音形码顶功输入方案。

    该方案基于Colemak-DH Matrix布局，并对简码及词库进行了大幅优化。


# 候选项菜单
menu:
  page_size: 2 # 候选项显示个数


# 模式切换开关
switches:
  - { name: ascii_mode, reset: 1 } # 中英文切换（默认英文）
  - { name: extended_charset, reset: 1 } # CJK字符集切换（默认全字符集）
  - { name: full_shape, reset: 0 } # 全角半角切换（默认半角）


# 标点符号
punctuator:
  import_preset: sphs.punct # 导入标点符号配置


# 输入方案引擎
engine:
  processors: # 处理器 -> 响应按键并按照预设的规则依次进行编码处理
    - ascii_composer # 与ascii_segmentor搭配，处理英文模式下的输入编码
    - recognizer # 与matcher搭配，处理特定结构的编码（计算器、编码反查等）
    - key_binder # 绑定按键并赋予功能（或重新定义按键本身）
    - lua_processor@topup_processor # 判断是否顶功与顶功的内容
    - lua_processor@sphs_select_processor # 使特定按键可以选择特定候选项（单引号、斜杠等）
    - speller # 将输入编码根据拼写运算规则编辑输入区
    - punctuator # 与punct_segmentor搭配，将特定按键映射为标点符号（逗号、句号等）
    - selector # 将特定按键映射为选择键（数字键、上/下方向键、PageUp/PageDown等）
    - navigator # 使特定按键可以移动输入区中的光标（左/右方向键等）
    - express_editor # 将特定按键映射为编辑键（空格、回车、回退键等）
  segmentors: # 分段器 -> 将输入编码根据结构进行段落划分与标记
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators: # 转换器 -> 将划分好的编码段转换为对应候选项
    - punct_translator
    - history_translator@repeat_history
    - table_translator@custom_phrase
    - table_translator@char_lookup
    - lua_translator@date_translator
    - lua_translator@time_translator
    - lua_translator@number_translator
  filters: # 过滤器 -> 将转换好的候选项进行过滤（增删改查）
    - uniquifier
    - lua_filter@sphs_cand_filter
    - reverse_lookup_filter@char_lookup


layout:
  topup:
    topup_this: "bcdefghjklmnpqrstwxyz"
    topup_with: "avuio;"
  algebra:
    - derive/^[bcdefghjklmnpqrstwxyz;]([bcdefghjklmnpqrstwxyz;][avuio].*)$/`$1/
    - derive/^([bcdefghjklmnpqrstwxyz;])[bcdefghjklmnpqrstwxyz;]([avuio].*)$/$1`$2/
    - derive/^([bcdefghjklmnpqrstwxyz;`]{2})[avuio](.*)$/$1`$2/
    - derive/^([bcdefghjklmnpqrstwxyz;`]{2}[avuio`]).(.*)$/$1`$2/
    - derive/^([bcdefghjklmnpqrstwxyz;`]{2}[avuio`]{2}).(.*)$/$1`$2/
    - derive/^([bcdefghjklmnpqrstwxyz;`]{2}[avuio`]{3}).(.*)$/$1`$2/
    - derive/^([bcdefghjklmnpqrstwxyz;`]{2}[avuio`]{4}).(.*)$/$1`$2/
    - derive/^([bcdefghjklmnpqrstwxyz;`]{2}[avuio`]{5}).$/$1`/
    - derive/^[bcdefghjklmnpqrstwxyz;]{2}([avuio`]*)$/``$1/
  patterns:
    special: "^(?:;?[avuio])[a-z]{0,}"


topup:
  __include: "layout/topup"
  min_length: 4
  max_length: 6
  auto_clear: true
  min_length_danzi: 2
  topup_command: true


# 截取特定结构的编码传递给下个逻辑块（避免某些按键直接上屏/清空输入区字符串）
recognizer:
  patterns: # 配合segmentor的prefix和suffix完成段落划分与标记
    calculator: "^=[^;']+$" # 计算器
    char_lookup: "[a-z`]*`+[a-z`]*" # 编码反查


# 根据拼写运算规则编辑输入区
speller:
  algebra: # 核心拼写运算规则（编译后会写入build文件夹中的prism文件）
    __include: "layout/algebra" # 导入拼写运算规则
  auto_select: true # 是否开启自动上屏
  auto_select_unique_candidate: true # 是否开启无重码时自动上屏（仅在编码吻合时判断）
  alphabet: "abcdefghijklmnopqrstuvwxyz;/=`" # 待监听的按键
  initials: "abcdefghijklmnopqrstuvwxyz;/=`" # 待监听的首位按键（引导键）


translator:
  dictionary: sphs
  enable_charset_filter: false
  enable_completion: true
  enable_encoder: true
  enable_sentence: false
  enable_user_dict: false
  encode_commit_history: true
  max_phrase_length: 6


repeat_history:
  input: /
  size: 100
  initial_quality: 10000


custom_phrase:
  dictionary: ""
  user_dict: user_dict
  db_class: stabledb
  enable_sentence: false
  initial_quality: 0


char_lookup:
  dictionary: sphs
  tags: [ char_lookup ]
  overwrite_comment: true
  enable_charset_filter: false
  enable_completion: true
  enable_encoder: false
  enable_sentence: false
  enable_user_dict: false
  encode_commit_history: false
  comment_format:
    - xform/~[a-z;]+//
